<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Inicio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='output.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;800&display=swap" rel="stylesheet">
    <style>
        /* Fondo oscuro del modal */
        #commentModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 50;
            overflow-y: auto;
        }
        
        /* Contenido del modal */
        #commentModalContent {
            background: white;
            width: 90%;
            max-width: 1200px; /* Tamaño máximo más amplio */
            max-height: 95vh; /* Altura máxima del modal */
            padding: 30px;
            border-radius: 15px;
            display: flex;
            gap: 20px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
            animation: fadeInModal 0.3s ease;
            overflow-y: auto; /* Scroll automático si excede la altura */
        }
    
        /* Animación para el modal */
        @keyframes fadeInModal {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    
        /* Imagen más grande */
        .flex-shrink-0 {
            width: 600px;
            height: 600px;
        }
    
        /* Información del autor */
        .author-info {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }
        .author-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid #ddd;
        }
        .author-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }
        .author-role {
            font-size: 0.875rem;
            color: #888;
        }
    
        /* Sección de comentarios con altura optimizada */
        .comment-section {
            border-left: 1px solid #ddd;
            padding-left: 20px;
            max-height: 60vh; /* Altura máxima para comentarios */
            overflow-y: auto;
            padding-top: 15px;
        }
    
        /* Estilo de cada comentario */
        .comment-item {
            display: flex;
            margin-bottom: 15px;
        }
        .comment-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #e5e7eb;
        }
        .comment-text {
            background-color: #f9fafb;
            padding: 8px 12px;
            border-radius: 12px;
            color: #4b5563;
            font-size: 0.875rem;
            word-break: break-word;
        }
        .comment-date {
            font-size: 0.75rem;
            color: #6b7280;
        }
    
        /* Formulario de comentarios */
        .comment-form {
            display: flex;
            align-items: center;
            gap: 10px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
            margin-top: auto;
        }
        .comment-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s ease;
        }
        .comment-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
    
        /* Botón de enviar comentario */
        .submit-button {
            background-color: #3b82f6;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        .submit-button:hover {
            background-color: #2563eb;
        }
    
        /* Contador de caracteres */
        .char-count {
            font-size: 0.875rem;
            color: #6b7280;
            text-align: right;
        }
    
        /* Ocultar barra de desplazamiento */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    
        /* Evitar scroll en el fondo cuando el modal está abierto */
        body.modal-open {
            overflow: hidden;
        }
    
        /* Efecto de entrada para las tarjetas de contenido */
        .card {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .card-visible {
            opacity: 1;
            transform: translateY(0);
        }
    
        /* Ajuste para el contenido de texto largo */
        .post-content {
            overflow-wrap: anywhere;
            word-break: break-word;
        }
    </style>
    
    
</head>
<body class="bg-gray-100 font-[Poppins]">
    <div class="lg:w-[300px] fixed lg:relative inset-y-0 z-40 bg-gray-900">
        {% include 'sidebar.html' %}
    </div>
    <div class="lg:ml-[300px] p-8 mt-16 lg:mt-0 transition-all duration-300 ease-in-out" id="main-content">
        <div class="flex flex-col items-center p-8 bg-gray-100 min-h-screen">
            <div class="w-full max-w-2xl mb-8 flex justify-between items-center">
                <h1 class="text-3xl font-bold text-gray-800">Últimas Publicaciones</h1>
                <a href="{{ url_for('create_post') }}" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300">
                    Crear Publicación
                </a>
            </div>
            <div class="w-full max-w-2xl space-y-6">
                {% for post in posts %}
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition duration-300 card flex flex-col">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <img src="{{ post.profile_image }}" alt="Foto de perfil" class="w-12 h-12 rounded-full border border-gray-300 mr-4">
                                <div>
                                    <h2 class="font-bold text-lg text-gray-800">{{ post.Name }}</h2>
                                    <p class="text-gray-500 text-sm">{{ post.PostDate.strftime('%Y-%m-%d %H:%M') }}</p>
                                </div>
                            </div>
                            <button onclick="openCommentModal('{{ post.PostID }}', '{{ post.Name }}', '{{ post.Content }}', '{{ post.Image }}', '{{ post.profile_image }}')" class="text-gray-500 hover:text-gray-700">
                                <i class="bi bi-chat-dots text-2xl"></i>
                            </button>
                        </div>
                        <p class="text-gray-700 mb-4 leading-relaxed post-content postContent max-h-20 overflow-hidden" data-expanded="false">
                            {{ post.Content[:200] }}
                            {% if post.Content|length > 200 %}
                                <span class="text-blue-500 cursor-pointer toggleContent"> Ver más</span>
                            {% endif %}
                        </p>
                        
                        
                        {% if post.Image %}
                            <img src="{{ post.Image }}" alt="Imagen del post" class="w-full max-h-80 object-cover rounded-lg cursor-pointer" onclick="openModal('{{ post.Image }}')">
                        {% endif %}
                    </div>
                {% else %}
                    <p class="text-center text-gray-600">No hay publicaciones disponibles.</p>
                {% endfor %}
            </div>
        </div>
<!-- Modal de comentarios -->
<div id="commentModal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50" onclick="closeCommentModal(event)">
    <div id="commentModalContent" class="bg-white w-full max-w-4xl max-h-[95vh] mx-4 lg:mx-8 p-8 rounded-lg shadow-lg flex gap-8 overflow-hidden" onclick="event.stopPropagation()">
        <!-- Imagen del post y avatar del autor -->
        <div class="flex-shrink-0 rounded-lg w-[600px] h-[600px] bg-gray-200 relative overflow-hidden shadow-md">
            <img id="postImage" src="" alt="Imagen del post" class="w-full h-full object-cover rounded-lg">
        </div>
        
        <!-- Contenido y comentarios -->
        <div class="flex flex-col w-full h-full">
            <!-- Información del autor -->
            <div class="flex items-center gap-4 border-b pb-4 mb-4">
                <img id="postProfileImage" src="" alt="Avatar del autor" class="w-14 h-14 rounded-full border border-gray-300">
                <div>
                    <h2 id="postAuthor" class="font-semibold text-xl text-gray-800">Nombre del Autor</h2>
                    <p id="postContent" class="text-gray-600 text-sm mt-1 overflow-hidden max-h-20" data-expanded="false"></p>
                    <button id="toggleContent" onclick="toggleContent()" class="text-blue-500 hover:text-blue-700 mt-1 text-sm hidden">Ver más</button>
                </div>
            </div>
            
            <!-- Sección de comentarios -->
            <h3 class="text-lg font-semibold text-gray-800 mb-2">Comentarios:</h3>
            <div id="commentsContainer" class="space-y-4 max-h-[40vh] overflow-y-auto pr-2 scrollbar-hide mb-4">
                <!-- Aquí se cargan los comentarios -->
            </div>

            <!-- Formulario para añadir comentarios -->
            <form id="commentForm" onsubmit="submitComment(event)" class="mt-auto flex items-center gap-3 border-t pt-4">
                <img src="{{ user['profile_image'] }}" alt="Tu Avatar" class="w-8 h-8 rounded-full bg-gray-300">
                <div class="flex-1 relative">
                    <input type="text" name="comment_content" id="commentInput" placeholder="Escribe un comentario..." maxlength="30" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10" required>
                    <span id="charCount" class="absolute right-3 top-2 text-gray-500 text-sm">30</span>
                </div>
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Comentar</button>
            </form>
        </div>
    </div>
</div>



        <script>
            const commentInput = document.getElementById('commentInput');
    const charCount = document.getElementById('charCount');
    const maxChars = 30;

    commentInput.addEventListener('input', () => {
        const remaining = maxChars - commentInput.value.length;
        charCount.textContent = remaining;
    });
            const cards = document.querySelectorAll('.card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('card-visible');
                    }
                });
            }, { threshold: 0.1 });
        
            cards.forEach(card => observer.observe(card));
        
            function openCommentModal(postID, author, content, imageSrc, profileImage) {
                const modal = document.getElementById('commentModal');
                modal.style.display = 'flex';
                document.body.classList.add('modal-open'); // Evita el scroll del fondo
        
                document.getElementById('postImage').src = imageSrc;
                document.getElementById('postProfileImage').src = profileImage;
                document.getElementById('postAuthor').innerText = author;
                document.getElementById('postContent').innerText = content;
        
                const form = document.getElementById('commentForm');
                form.action = `/add_comment/${postID}`;
        
                loadComments(postID);
            }
        
            function closeCommentModal(event) {
                const modal = document.getElementById('commentModal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                    document.body.classList.remove('modal-open'); // Restablece el scroll del fondo
                }
            }
        
            function loadComments(postID) {
                const commentsContainer = document.getElementById('commentsContainer');
                commentsContainer.innerHTML = '';
        
                fetch(`/get_comments/${postID}`)
                    .then(response => response.json())
                    .then(comments => {
                        comments.forEach(comment => {
                            const commentItem = document.createElement('div');
                            commentItem.classList.add('comment-item');
                            commentItem.innerHTML = `
                                <img src="${comment.profile_image}" alt="Avatar" class="comment-avatar">
                                <div>
                                    <p class="text-sm font-medium text-gray-800">${comment.Name}</p>
                                    <p class="text-sm text-gray-600">${comment.Content}</p>
                                    <p class="text-xs text-gray-500">${new Date(comment.CommentDate).toLocaleString()}</p>
                                </div>
                            `;
                            commentsContainer.appendChild(commentItem);
                        });
                    })
                    .catch(error => console.error('Error al cargar los comentarios:', error));
            }
        
            function submitComment(event) {
                event.preventDefault();
                const postID = document.getElementById('commentForm').action.split('/').pop();
                const formData = new FormData(event.target);
        
                fetch(`/add_comment/${postID}`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadComments(postID);
                        event.target.reset();
                    } else {
                        console.error("Error al agregar el comentario");
                    }
                })
                .catch(error => console.error('Error al enviar el comentario:', error));
            }
        </script>
    </div>
</body>
</html>
