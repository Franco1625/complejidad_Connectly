<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<div id="overlay" class="fixed inset-0 bg-black bg-opacity-25 hidden z-30 transition-opacity duration-300"></div>

<div id="sidebar" class="bg-[#2B4D7A] text-white w-24 h-full fixed top-0 left-0 p-4 transition-all duration-300 transform flex flex-col items-center z-40 rounded-r-xl border-r-2 border-[#374151]">
    <div class="flex items-center justify-start mb-10 w-full cursor-pointer" id="toggleSidebar">
        <img src="/./static/images/logo.png" alt="Logo" class="rounded-full w-14 h-14">
        <span class="text-3xl font-semibold ml-2 sidebar-text hidden" id="sidebarLabel">Connectly</span>
    </div>

    <div class="flex flex-col space-y-8 flex-grow items-center w-full">
        <a href="{{ url_for('index') }}" class="flex items-center space-x-4  transition w-full p-3 rounded-md hover:bg-[#1E3A8A]">
            <span class="material-icons text-4xl">home</span>
            <span class="text-xl sidebar-text hidden" id="homeLabel">Home</span>
        </a>

        {% if user %}
        <a href="{{ url_for('profile', user_id=user.user_id) }}" class="flex items-center space-x-4 transition w-full p-3 rounded-md hover:bg-[#1E3A8A]">
            <span class="material-icons text-4xl">account_circle</span>
            <span class="text-xl sidebar-text hidden" id="profileLabel">Profile</span>
        </a>

        <a href="{{ url_for('logout') }}" class="flex items-center space-x-4 transition w-full p-3 rounded-md hover:bg-[#1E3A8A] ">
            <span class="material-icons text-4xl">logout</span>
            <span class="text-xl sidebar-text hidden truncate" id="logoutLabel">Logout</span>
        </a>
        {% endif %}
    </div>

    {% if user %}
    <div class="mt-auto flex items-center cursor-pointer w-full justify-center lg:justify-start" id="toggleProfile">
        <img src="{{ user.profile_image }}" alt="User Image" class="w-14 h-14 rounded-full border-2 border-white">
        <div class="ml-2 text-left sidebar-text hidden" id="userInfo">
            <p class="text-white font-semibold text-lg">{{ user.name }}</p>
            <p class="text-gray-300 text-sm">Web Developer</p>
        </div>
    </div>
    {% endif %}
</div>

<script>
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const toggleSidebar = document.getElementById('toggleSidebar');
    const body = document.body;

    const sidebarText = document.querySelectorAll('.sidebar-text');

    function toggleSidebarVisibility() {
        sidebar.classList.toggle('w-24');
        sidebar.classList.toggle('w-64');
        sidebar.classList.toggle('items-center');
        sidebar.classList.toggle('items-start');
        overlay.classList.toggle('hidden');

        const isExpanded = sidebar.classList.contains('w-64');
        
        if (isExpanded) {
            body.style.overflow = 'hidden';
            sidebarText.forEach(el => {
                el.classList.remove('hidden');
                el.classList.add('slide-in');
            });
        } else {
            body.style.overflow = '';
            sidebarText.forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('slide-in');
            });
        }
    }

    toggleSidebar.addEventListener('click', toggleSidebarVisibility);
    document.getElementById('toggleProfile').addEventListener('click', toggleSidebarVisibility);

    document.addEventListener('click', function(event) {
        const isClickInside = sidebar.contains(event.target) || toggleSidebar.contains(event.target);
        if (!isClickInside && sidebar.classList.contains('w-64')) {
            toggleSidebarVisibility();
        }
    });

    overlay.addEventListener('click', toggleSidebarVisibility);
</script>

<style>
    #overlay {
        background-color: rgba(0, 0, 0, 0.25);
    }

    .sidebar-text {
        opacity: 0;
        transform: translateX(-20px);
        transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .slide-in {
        opacity: 1;
        transform: translateX(0);
    }
</style>
